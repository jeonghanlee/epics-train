Recipe for setting up tools
===========================

# Set environment variables and aliases for now
source ~/epics-train/settings.sh
# .. and for eternity
echo >>~/.bashrc source ~/epics-train/settings.sh

cd ~/epics-train/tools

# Disable firewall
sudo systemctl stop firewalld
sudo systemctl disable firewalld

# EPICS Base
sudo yum install readline-devel
wget https://www.aps.anl.gov/epics/download/base/base-3.15.5.tar.gz
tar vzxf base-3.15.5.tar.gz
cd base-3.15.5
patch -p 1 < ../0001-db-fix-dbGet-of-link-fields-as-DBF_CHAR.patch
make
cd ..


# EPICS V4
wget https://sourceforge.net/projects/epics-pvdata/files/4.6.0/EPICS-CPP-4.6.0.tar.gz
tar vzxf EPICS-CPP-4.6.0.tar.gz
cd EPICS-CPP-4.6.0
make
cd ..


# EPICS V4 Python
sudo yum install numpy
sudo yum install python-devel
sudo yum install boost-devel
sudo yum install boost-python
cd pvaPy
make configure EPICS_BASE=$EPICS_BASE EPICS4_DIR=$EPICS_BASE4
make
cd ..


# Example V4 image and SNS neutron data similator
git clone https://github.com/kasemir/EPICSV4Sandbox.git
# Get the previous version that has byte[], not short[] for image data
git checkout d4f69b129a7c3d22769ba445abc535ef7b4199b3
(cd EPICSV4Sandbox/neutronsDemoServer; make)
(cd EPICSV4Sandbox/ntndarrayServer; make)


# Java
# Can't automate. Need to download JDK 8 from
# http://www.oracle.com/technetwork/java/javase/downloads/index.html
tar vzxf ~/Downloads/jdk-8u121-linux-x64.tar.gz


# CSS
wget https://ics-web.sns.ornl.gov/css/nightly/basic-epics-4.2.0-linux.gtk.x86_64.zip
unzip basic-epics-4.2.0-linux.gtk.x86_64.zip
mv basic-epics-4.2.0 CSS
rm basic-epics-4.2.0-linux.gtk.x86_64.zip

# Add PyDev
REPO=http://ics-web.sns.ornl.gov/css/nightly/repo
P2="java -Declipse.p2.mirrors=false 
    -jar CSS/plugins/org.eclipse.equinox.launcher_*.jar 
    -application org.eclipse.equinox.p2.director "
# Look for installable modules:
#  $P2 -repository $REPO -list  |  fgrep pydev.feature.group
$P2 -installIU org.csstudio.sns.feature.pydev.feature.group -repository $REPO -destination CSS -tag "PyDev"

# CSS Workspace:
# When started for the first time with a new workspace,
# there can be a PyDev prompt to configure python:
# Choose automatic config.
# 
# Exit CSS in 'CS-Studio' perspective


# Standalone Display Builder Runtime
wget https://ics-web.sns.ornl.gov/css/display.builder/display-runtime-0.1-linux.gtk.x86_64.zip
unzip display-runtime-0.1-linux.gtk.x86_64.zip
rm display-runtime*zip
mv display-runtime* display-runtime


# C-Python support for CSS
sudo easy_install py4j

mkdir /tmp/s
cd /tmp/s
unzip ~/epics-train/tools/CSS/plugins/org.csstudio.display.builder.runtime_*.jar 
cd scripts/
python setup.py install
sudo python setup.py install
cd
rm -rf /tmp/s



# State before taking snapwhot of VM:
# CSS left in reset 'CS-Studio' perspective,
# no files added, no "Display Builder" samples installed,
# ~/.bash_history cleared
