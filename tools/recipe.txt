Recipe for setting up tools
===========================

~/epics-train/tools contains all the tools: EPICS base, asyn, CS-Studio, ...

~/epics-train/settings.sh sets PATH etc.
To make this more modular, it's actually sourcing all files in ~/epics-train/tools/profile.d

# Arrange for settings.sh to be sourced:
echo >>~/.bashrc source ~/epics-train/settings.sh
#
# Close terminal, open new terminal to see the effect.


# Disable firewall
sudo systemctl stop firewalld
sudo systemctl disable firewalld


# EPICS Base
sudo yum install -y readline-devel
cd ~/epics-train/tools
wget https://epics.anl.gov/download/base/base-7.0.1.1.tar.gz
tar vzxf base-7.0.1.1.tar.gz
rm base-7.0.1.1.tar.gz
cd base-7.0.1.1
make clean uninstall
make


# EtherIP
cd ~/epics-train/tools
git clone https://github.com/EPICSTools/ether_ip.git
cd ether_ip
make
echo "ETHER_IP = "`pwd` >> ~/epics-train/RELEASE.local


# Autosave
cd ~/epics-train/tools
wget https://github.com/epics-modules/autosave/archive/R5-9.zip
unzip R5-9.zip
rm R5-9.zip 
cp ether_ip/configure/RELEASE autosave-R5-9/configure
cd autosave-R5-9
make clean uninstall
make
echo "AUTOSAVE = "`pwd` >> ~/epics-train/RELEASE.local

# Example V4 image and SNS neutron data similator
cd ~/epics-train/tools
git clone https://github.com/kasemir/EPICSV4Sandbox.git
(cd EPICSV4Sandbox/neutronsDemoServer; make)
(cd EPICSV4Sandbox/ntndarrayServer; make)


# Java
# Can't automate. Need to download JDK 8 (tar.gz, not the rpm) and 10
# from http://www.oracle.com/technetwork/java/javase/downloads/index.html
tar vzxf jdk-8u*-linux-x64.tar.gz
tar vzxf jdk-10*linux-x64*.tar.gz


# VDCT
wget https://github.com/epics-extensions/VisualDCT/releases/download/v2.8.0/VisualDCT-2.8.0-distribution.tar.gz
tar vzxf VisualDCT-2.8.0-distribution.tar.gz 
rm VisualDCT-2.8.0-distribution.tar.gz 


# CSS/Phoebus
wget https://ics-web.sns.ornl.gov/css/phoebus/phoebus-0.0.1.zip
unzip phoebus-0.0.1.zip


# EPICS pvaPY Module
cd ~/epics-train/tools/
sudo yum install -y numpy
sudo yum install -y python-devel
sudo yum install -y boost-devel
sudo yum install -y boost-python
git clone https://github.com/epics-base/pvaPy.git
cd pvaPy
make configure EPICS_BASE=$EPICS_BASE
make


# ^^^^^^^^^^^^^^^^^^^^ DONE ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

# CSS
wget https://ics-web.sns.ornl.gov/css/nightly/basic-epics-4.5.0-linux.gtk.x86_64.zip
unzip basic-epics-4.5.0-linux.gtk.x86_64.zip
mv basic-epics-4.5.0 CSS
rm basic-epics-4.5.0-linux.gtk.x86_64.zip

# Exit CSS in 'CS-Studio' perspective



# EDM
cd ~/epics-train/tools
# Prepare EPICS 'extensions' directory
wget https://epics.anl.gov/download/extensions/extensionsTop_20120904.tar.gz
tar vzxf extensionsTop_20120904.tar.gz
.. configure extensions/configure/RELEASE

# Get EDM from https://epics.anl.gov/extensions/index.php,
# unpack into ~/epics-train/tools/extensions/src
# Get dependencies
sudo yum install libXt-devel
sudo yum install libXmu-devel
sudo yum install motif-devel
sudo yum install libXtst-devel
sudo yum install giflib-devel
sudo yum install xorg-x11-fonts-75dpi
sudo yum install xorg-x11-fonts-ISO8859-1-75dpi

cd ~/epics-train/tools/extensions/src/edm
make

cd setup
export EDMFILES=/home/training/epics-train/tools/extensions/src/edm/setup
export EDMOBJECTS=$EDMFILES
export EDMPVOBJECTS=$EDMFILES
export PATH=/home/training/epics-train/tools/extensions/bin/linux-x86_64:$PATH
edm -add /home/training/epics-train/tools/extensions/lib/linux-x86_64/libEdmBase.so 
edm -add /home/training/epics-train/tools/extensions/lib/linux-x86_64/lib57d79238-2924-420b-ba67-dfbecdf03fcd.so
edm -addpv /home/training/epics-train/tools/extensions/lib/linux-x86_64/libEpics.so 
edm -addpv /home/training/epics-train/tools/extensions/lib/linux-x86_64/libCalc.so 
edm -addpv /home/training/epics-train/tools/extensions/lib/linux-x86_64/libLoc.so 

cd /home/training/epics-train/tools
cp edm_fonts.list extensions/src/edm/setup/fonts.list


# C-Python support for CSS
sudo easy_install py4j

mkdir /tmp/s
cd /tmp/s
unzip ~/epics-train/tools/CSS/plugins/org.csstudio.display.builder.runtime_*.jar 
cd scripts/
sudo python setup.py install
cd
rm -rf /tmp/s



cd ~/epics-train/examples
make


# State before taking snapwhot of VM:
# CSS left in reset 'CS-Studio' perspective,
# no files added, no "Display Builder" samples installed,
# ~/.bash_history cleared
